# ðŸš€ Quick Start: React Email + Resend

The fastest way to create beautiful emails for Madison Studio.

---

## âš¡ Setup (5 minutes)

### 1. Install React Email

```bash
cd "/Users/jordanrichter/Projects/Madison Studio/madison-app"
npm install react-email @react-email/components
```

### 2. Add Scripts to package.json

```json
{
  "scripts": {
    "email:dev": "email dev",
    "email:export": "email export"
  }
}
```

### 3. Create Email Directory

```bash
mkdir -p emails/components
```

---

## ðŸ“§ Create Your First Email

### Create: `emails/BrandAuditReport.tsx`

```tsx
import * as React from 'react';
import {
  Body,
  Button,
  Container,
  Head,
  Heading,
  Html,
  Preview,
  Section,
  Text,
  Hr,
} from '@react-email/components';

interface BrandAuditReportProps {
  brandName: string;
  reportUrl: string;
  pdfUrl?: string;
}

export default function BrandAuditReport({
  brandName = 'Your Brand',
  reportUrl = 'https://app.madisonstudio.io/report',
  pdfUrl,
}: BrandAuditReportProps) {
  return (
    <Html>
      <Head />
      <Preview>Your Brand Audit for {brandName} is Ready! ðŸŽ‰</Preview>
      <Body style={main}>
        <Container style={container}>
          {/* Header */}
          <Heading style={h1}>
            Your Brand Audit is Ready! ðŸŽ‰
          </Heading>
          
          {/* Introduction */}
          <Text style={text}>
            We've completed your brand audit for <strong>{brandName}</strong>. 
            Your comprehensive brand report is ready to view.
          </Text>

          {/* Highlight Box */}
          <Section style={highlightBox}>
            <Text style={highlightTitle}>ðŸ“Š What's Included:</Text>
            <Text style={listText}>
              â€¢ Brand identity & positioning analysis<br />
              â€¢ Visual language (colors, typography)<br />
              â€¢ Messaging & copy assessment<br />
              â€¢ Strategic recommendations
            </Text>
          </Section>

          {/* Primary CTA */}
          <Section style={buttonContainer}>
            <Button style={button} href={reportUrl}>
              View Living Report â†’
            </Button>
          </Section>

          {/* Secondary CTA (if PDF available) */}
          {pdfUrl && (
            <>
              <Text style={smallText}>Or download the PDF version:</Text>
              <Section style={buttonContainer}>
                <Button style={secondaryButton} href={pdfUrl}>
                  Download PDF Report
                </Button>
              </Section>
            </>
          )}

          {/* Tip (if no PDF) */}
          {!pdfUrl && (
            <Section style={tipBox}>
              <Text style={tipText}>
                <strong>ðŸ’¡ Tip:</strong> Your report is a "living document" that updates 
                automatically with each new scan. Bookmark the link above to always see 
                your latest brand analysis.
              </Text>
            </Section>
          )}

          {/* Footer */}
          <Hr style={hr} />
          <Text style={footer}>
            This report was generated by <strong>Madison Studio</strong>.<br />
            Questions? Reply to this email or visit{' '}
            <a href="https://madisonstudio.io" style={link}>
              Madison Studio
            </a>
          </Text>
        </Container>
      </Body>
    </Html>
  );
}

// Styles
const main = {
  backgroundColor: '#F5F1E8',
  fontFamily: '-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Ubuntu,sans-serif',
  padding: '40px 20px',
};

const container = {
  backgroundColor: '#ffffff',
  margin: '0 auto',
  padding: '40px',
  borderRadius: '8px',
  maxWidth: '600px',
  boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
};

const h1 = {
  color: '#2D2D2D',
  fontSize: '28px',
  fontWeight: '600',
  lineHeight: '1.3',
  margin: '0 0 24px 0',
};

const text = {
  color: '#666666',
  fontSize: '16px',
  lineHeight: '1.6',
  margin: '0 0 24px 0',
};

const highlightBox = {
  backgroundColor: '#F5F1E8',
  padding: '24px',
  borderRadius: '6px',
  borderLeft: '4px solid #C4A962',
  margin: '0 0 32px 0',
};

const highlightTitle = {
  color: '#2D2D2D',
  fontSize: '14px',
  fontWeight: '600',
  margin: '0 0 8px 0',
};

const listText = {
  color: '#666666',
  fontSize: '14px',
  lineHeight: '1.8',
  margin: '0',
};

const buttonContainer = {
  margin: '0 0 16px 0',
};

const button = {
  backgroundColor: '#C4A962',
  color: '#2D2D2D',
  padding: '16px 32px',
  borderRadius: '6px',
  fontWeight: '600',
  fontSize: '16px',
  textDecoration: 'none',
  textAlign: 'center' as const,
  display: 'block',
};

const secondaryButton = {
  backgroundColor: '#2D2D2D',
  color: '#FFFFFF',
  padding: '14px 28px',
  borderRadius: '6px',
  fontWeight: '600',
  fontSize: '14px',
  textDecoration: 'none',
  textAlign: 'center' as const,
  display: 'block',
};

const smallText = {
  color: '#666666',
  fontSize: '14px',
  margin: '0 0 12px 0',
};

const tipBox = {
  margin: '0 0 32px 0',
};

const tipText = {
  color: '#666666',
  fontSize: '14px',
  lineHeight: '1.6',
  margin: '0',
};

const hr = {
  borderColor: '#E5E5E5',
  margin: '32px 0 24px 0',
};

const footer = {
  color: '#999999',
  fontSize: '12px',
  lineHeight: '1.6',
  margin: '0',
};

const link = {
  color: '#C4A962',
  textDecoration: 'none',
};
```

---

## ðŸ§ª Preview Your Email

### Start Dev Server

```bash
npm run email:dev
```

This opens http://localhost:3000 where you can:
- âœ… See live preview
- âœ… Test with different props
- âœ… View in light/dark mode
- âœ… Copy HTML output

---

## ðŸ”Œ Use in Edge Function

### Update: `supabase/functions/send-report-email/index.ts`

```typescript
import { serve } from "https://deno.land/std@0.168.0/http/server.ts";
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";
// Import React Email render function
import { render } from "npm:@react-email/render";
// Import your email component
import BrandAuditReport from "../../../emails/BrandAuditReport.tsx";

const corsHeaders = {
  "Access-Control-Allow-Origin": "*",
  "Access-Control-Allow-Headers": "authorization, x-client-info, apikey, content-type",
};

serve(async (req) => {
  if (req.method === "OPTIONS") {
    return new Response(null, { headers: corsHeaders });
  }

  try {
    const { 
      userEmail, 
      domain, 
      reportUrl, 
      pdfUrl,
      brandName 
    } = await req.json();

    if (!userEmail || !domain || !reportUrl) {
      return new Response(
        JSON.stringify({ error: "userEmail, domain, and reportUrl are required" }),
        { status: 400, headers: { ...corsHeaders, "Content-Type": "application/json" } }
      );
    }

    console.log(`[send-report-email] Sending report email to ${userEmail} for ${domain}`);

    const RESEND_API_KEY = Deno.env.get("RESEND_API_KEY");
    const EMAIL_FROM = Deno.env.get("EMAIL_FROM") || "Madison Studio <hello@madisonstudio.io>";
    
    if (!RESEND_API_KEY) {
      console.warn("[send-report-email] RESEND_API_KEY not configured, skipping email");
      return new Response(
        JSON.stringify({ 
          message: "Email service not configured",
          skipped: true 
        }),
        { headers: { ...corsHeaders, "Content-Type": "application/json" } }
      );
    }

    const displayBrandName = brandName || domain;
    
    // Render React Email component to HTML
    const emailHtml = render(
      BrandAuditReport({
        brandName: displayBrandName,
        reportUrl: reportUrl,
        pdfUrl: pdfUrl,
      })
    );

    // Send email via Resend
    const emailResponse = await fetch("https://api.resend.com/emails", {
      method: "POST",
      headers: {
        "Authorization": `Bearer ${RESEND_API_KEY}`,
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        from: EMAIL_FROM,
        to: [userEmail],
        subject: `Your Brand Audit for ${displayBrandName} is Ready`,
        html: emailHtml,
        reply_to: EMAIL_FROM,
      }),
    });

    if (!emailResponse.ok) {
      const error = await emailResponse.text();
      console.error("[send-report-email] Resend API error:", error);
      throw new Error(`Failed to send email: ${error}`);
    }

    const result = await emailResponse.json();
    console.log("[send-report-email] Report email sent successfully:", result);

    return new Response(
      JSON.stringify({
        success: true,
        messageId: result.id,
      }),
      { headers: { ...corsHeaders, "Content-Type": "application/json" } }
    );

  } catch (error) {
    console.error("[send-report-email] Error:", error);
    return new Response(
      JSON.stringify({
        error: error instanceof Error ? error.message : "Unknown error",
        details: error instanceof Error ? error.stack : String(error),
      }),
      { status: 500, headers: { ...corsHeaders, "Content-Type": "application/json" } }
    );
  }
});
```

---

## ðŸŽ¨ Create Reusable Components

### `emails/components/Button.tsx`

```tsx
import * as React from 'react';
import { Button as ReactEmailButton } from '@react-email/components';

interface ButtonProps {
  href: string;
  children: React.ReactNode;
  variant?: 'primary' | 'secondary';
}

export default function Button({ 
  href, 
  children, 
  variant = 'primary' 
}: ButtonProps) {
  const style = variant === 'primary' ? primaryButton : secondaryButton;
  
  return (
    <ReactEmailButton style={style} href={href}>
      {children}
    </ReactEmailButton>
  );
}

const primaryButton = {
  backgroundColor: '#C4A962',
  color: '#2D2D2D',
  padding: '16px 32px',
  borderRadius: '6px',
  fontWeight: '600',
  fontSize: '16px',
  textDecoration: 'none',
  textAlign: 'center' as const,
  display: 'block',
};

const secondaryButton = {
  backgroundColor: '#2D2D2D',
  color: '#FFFFFF',
  padding: '14px 28px',
  borderRadius: '6px',
  fontWeight: '600',
  fontSize: '14px',
  textDecoration: 'none',
  textAlign: 'center' as const,
  display: 'block',
};
```

### `emails/components/Footer.tsx`

```tsx
import * as React from 'react';
import { Text, Hr } from '@react-email/components';

export default function Footer() {
  return (
    <>
      <Hr style={hr} />
      <Text style={footer}>
        This email was sent by <strong>Madison Studio</strong>.<br />
        Questions? Reply to this email or visit{' '}
        <a href="https://madisonstudio.io" style={link}>
          Madison Studio
        </a>
      </Text>
    </>
  );
}

const hr = {
  borderColor: '#E5E5E5',
  margin: '32px 0 24px 0',
};

const footer = {
  color: '#999999',
  fontSize: '12px',
  lineHeight: '1.6',
  margin: '0',
};

const link = {
  color: '#C4A962',
  textDecoration: 'none',
};
```

---

## ðŸ“š More Email Templates

### Team Invitation

Create: `emails/TeamInvitation.tsx`

```tsx
import * as React from 'react';
import {
  Body,
  Button,
  Container,
  Head,
  Heading,
  Html,
  Preview,
  Section,
  Text,
} from '@react-email/components';
import Footer from './components/Footer';

interface TeamInvitationProps {
  organizationName: string;
  invitedByName: string;
  role: string;
  inviteUrl: string;
}

export default function TeamInvitation({
  organizationName = 'Your Organization',
  invitedByName = 'Team Member',
  role = 'Member',
  inviteUrl = 'https://app.madisonstudio.io/auth',
}: TeamInvitationProps) {
  return (
    <Html>
      <Head />
      <Preview>You've been invited to join {organizationName} on Madison Studio</Preview>
      <Body style={main}>
        <Container style={container}>
          <Heading style={h1}>
            You've been invited to join {organizationName}
          </Heading>
          
          <Text style={text}>
            {invitedByName} has invited you to join <strong>{organizationName}</strong> on 
            Madison Studio as a <strong>{role}</strong>.
          </Text>
          
          <Text style={text}>
            Click the button below to accept your invitation and get started:
          </Text>

          <Section style={buttonContainer}>
            <Button style={button} href={inviteUrl}>
              Accept Invitation
            </Button>
          </Section>

          <Text style={smallText}>
            If you didn't expect this invitation, you can safely ignore this email.
          </Text>

          <Text style={smallText}>
            This invitation will expire in 7 days.
          </Text>

          <Footer />
        </Container>
      </Body>
    </Html>
  );
}

// Styles (same as BrandAuditReport)
const main = { /* ... */ };
const container = { /* ... */ };
// ... etc
```

---

## âœ… Benefits of React Email

1. **Type Safety** - TypeScript support
2. **Component Reusability** - DRY principle
3. **Easy Testing** - Preview in browser
4. **Better Maintainability** - Clean, readable code
5. **Responsive by Default** - Works on all devices
6. **Dark Mode Support** - Automatic handling

---

## ðŸš€ Next Steps

1. **Install React Email**
   ```bash
   npm install react-email @react-email/components
   ```

2. **Create your first email template**
   - Copy the BrandAuditReport example above

3. **Preview it**
   ```bash
   npm run email:dev
   ```

4. **Update your edge function**
   - Use `render()` to convert React to HTML

5. **Deploy and test**
   ```bash
   supabase functions deploy send-report-email
   ```

---

**That's it!** You now have beautiful, maintainable email templates. ðŸŽ‰
